<html><body bgcolor="#000000" text="#ffffff"><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><p>
Mojtaba lives in Tehran. Tehran is a city with <b>n</b> squares and <b>n</b>-1 streets such that all of the squares are connected. The streets may have different lengths. The squares are numbered from 0 to <b>n</b>-1. The Grand Mosque of Tehran is at the square number 0.
</p>
<p>
Tehran can be viewed as a rooted weighted tree.
The node number 0 is the root.
You are given the description of the tree: for each i > 0 you are given the numbers par[i] and w[i].
Here, par[i] is the parent of node i, and w[i] is the length (in kilometers) of the street from i to par[i].
Note that the tree is numbered in such a way that par[i] &lt; i for all i &gt;= 1.
</p>
<p>
</p>
<p>
It's Friday and <b>q</b> people are going to travel from their homes to the Grand Mosque.
The people will travel one at a time, in the given order.
More precisely, person i+1 will start their journey only after person i parks their car and finishes their journey.
</p>
<p>
The cars consume 1 liter of fuel per kilometer.
</p>
<p>
In general, the journey of a person looks as follows:
Somewhere in Tehran there are cars parked by the previous travelers, and there may be some fuel available in them.
(The Iranians are kind, so they leave their fuel leftovers available for other travelers to the mosque.)
Person i starts from the square u[i] where they live.
When they start their journey, they are in their car and the car has f[i] liters of fuel.
Each person follows the same simple algorithm:
</p>
<pre>
while you are not at the Grand Mosque:
    let X be your current square
    collect all the fuel available in the cars parked at square X, and put all that fuel into your car
    let F be the amount of fuel you now have
    if F &gt;= w[X]:
        travel from X to par[X], which consumes w[X] liters of fuel
        upon arrival to par[X], receive 2*w[X] liters of fuel from the locals
    else:
        park your car at square X
        walk from there to the Grand Mosque
</pre>
<p>
After each person finishes their trip to the mosque, the locals in all the squares will <i>refill all the fuel that was taken from the parked cars</i>. Hence, once somebody parks a car somewhere and leaves L liters of fuel in that car, <i>each</i> future traveler will have those L liters available at that location.
</p>
<p>
The input is generated pseudorandomly, using parameters <b>A</b>, <b>B</b>, and <b>t</b>
Use the following pseudocode:
</p>
<pre>
    par[1] = 0
    for i = 2 to n-1:
        par[i] = Max(0, i - 1 - ((par[i - 1] * A + B) Modulo t) )

    w[1] = B
    for i = 2 to n-1:
        w[i] = (w[i - 1] * A + B) Modulo 10^9

    u[0] = B modulo N
    for i = 1 to q-1:
        u[i] = (u[i - 1] * A + B) Modulo n

    f[0] = B
    for i = 1 to q-1:
        f[i] = (f[i - 1] * A + B) Modulo 10^9
</pre>
<p>
For each person, determine the number of the square where they will park their car.
Return the sum of those numbers.
</p></td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>InThePathToMosque</td></tr><tr><td>Method:</td><td>solve</td></tr><tr><td>Parameters:</td><td>int, int, int, int, int</td></tr><tr><td>Returns:</td><td>long long</td></tr><tr><td>Method signature:</td><td>long long solve(int n, int q, int A, int B, int t)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td colspan="2"><h3>Limits</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Time limit (s):</td><td>2.000</td></tr><tr><td>Memory limit (MB):</td><td>256</td></tr><tr><td>Stack limit (MB):</td><td>256</td></tr></table></td></tr><tr><td colspan="2"><h3>Notes</h3></td></tr><tr><td align="center" valign="top">-</td><td>The queries are not independent and their order matters. Remember that each person may use fuel that was left in the cars by previous travelers.</td></tr><tr><td align="center" valign="top">-</td><td>The people who reach the mosque in their cars will park next to the Mosque, in the square number 0.</td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>n, q, t</b> will each be between 1 and 100,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>A, B</b> will each be between 0 and 10^9 - 1, inclusive.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>5</pre></td></tr><tr><td><pre>10</pre></td></tr><tr><td><pre>3</pre></td></tr><tr><td><pre>2</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 5</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>10</pre></td></tr><tr><td><pre>20</pre></td></tr><tr><td><pre>1234567</pre></td></tr><tr><td><pre>7654321</pre></td></tr><tr><td><pre>13</pre></td></tr></table></td></tr><tr><td><pre>Returns: 29</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>10</pre></td></tr><tr><td><pre>20</pre></td></tr><tr><td><pre>1234567</pre></td></tr><tr><td><pre>7654321</pre></td></tr><tr><td><pre>3</pre></td></tr></table></td></tr><tr><td><pre>Returns: 29</pre></td></tr><tr><td><table><tr><td colspan="2">The edges of the tree:
<pre>
x par[x] w[x]
1      0   7654321
2      0 779768328
3      1 253048297
4      1  84536720
5      2 252454561
6      5  77664408
7      6 922845657
8      6 801879840
9      7 396083601


</pre>
The first few queries:
<pre>
u[i] f[i]
   1   7654321
   8 779768328
   7 253048297
   0  84536720
   1 252454561
   8  77664408
   7 922845657
</pre></td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>
