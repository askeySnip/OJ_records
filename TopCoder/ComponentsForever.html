<html><body bgcolor="#000000" text="#ffffff"><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><p><i>
This problem has a non-standard time limit of 5 seconds.
</i></p>
<p>
A community of <b>n</b> frogs lives in a pond.
The frogs are numbered 0 through <b>n</b>-1.
Frog i lives at coordinates (X[i], Y[i]).
Use the following pseudocode to generate these coordinates:
</p>
<pre>
for i = 0 .. len(Xprefix)-1:
    X[i] = Xprefix[i]
    Y[i] = Yprefix[i]

state = seed

for i = len(Xprefix) .. n-1:
    state = (1103515245 * state + 12345)
    X[i] = state modulo Xrange
    state = state modulo 2^31
    state = (1103515245 * state + 12345)
    Y[i] = state modulo Yrange
    state = state modulo 2^31
</pre>

<p>
A hop is a move in which each coordinate of a frog changes by +1 or -1.
In other words, in a hop a frog can move from its current location to any of the four diagonally adjacent locations.
</p>

<p>
Each frog has a walkie-talkie.
There are two integers L &lt; R that describe their range.
Two frogs can communicate using their walkie-talkies if and only if there is some X in the closed interval [L,R] such that one frog can reach the other by making exactly X hops.
Note that X does not have to be the <i>smallest possible</i> number of hops between the two frogs.
</p>

<p>
A new frog named Manish recently visited this pond.
Manish is an experienced politician.
Ideally, he would want to make each frog a different promise.
However, Manish knows that some frogs can communicate, and he cannot make different promises to two frogs who can talk to each other.
Let P(L,R) be the largest number of different promises Manish can give the frogs for the values L and R.
</p>

<p>
You are given the ints <b>Llo</b> and <b>Rhi</b>.
Consider all pairs of integers (L,R) such that <b>Llo</b> &lt;= L &lt; R &lt;= <b>Rhi</b>.
Assume that the pair (L,R) is chosen uniformly at random from all these pairs.
Calculate the expected value of P(L,R).
Represent that value as a reduced fraction X/Y.
Return (X * Y^(-1)) modulo (10^9 + 7).
</p></td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>ComponentsForever</td></tr><tr><td>Method:</td><td>countComponents</td></tr><tr><td>Parameters:</td><td>int, vector &lt;int&gt;, vector &lt;int&gt;, int, int, int, int, int</td></tr><tr><td>Returns:</td><td>int</td></tr><tr><td>Method signature:</td><td>int countComponents(int n, vector &lt;int&gt; Xprefix, vector &lt;int&gt; Yprefix, int seed, int Xrange, int Yrange, int Llo, int Rhi)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td colspan="2"><h3>Limits</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Time limit (s):</td><td>5.000</td></tr><tr><td>Memory limit (MB):</td><td>256</td></tr></table></td></tr><tr><td colspan="2"><h3>Notes</h3></td></tr><tr><td align="center" valign="top">-</td><td>In the definition of the return value, Y^(-1) denotes the inverse element to Y when computing modulo 10^9 + 7. You may assume that for each valid input this value exists.</td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>n</b> will be between 2 and 75,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>Xprefix</b> will have between 0 and min(<b>n</b>,200) elements, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>Yprefix</b> will have the same number of elements as <b>Xprefix</b>.</td></tr><tr><td align="center" valign="top">-</td><td>Each element of <b>Xprefix</b> and <b>Yprefix</b> will be between 0 and 500,000,000 inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>seed</b> will be between 0 and 500,000,000 inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>Xrange</b> and <b>Yrange</b> will each be between 1 and 500,000,001 inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>Llo</b> and <b>Rhi</b> will satisfy 1 &lt;= <b>Llo</b> &lt; <b>Rhi</b> &lt;= 500,000,000.</td></tr><tr><td align="center" valign="top">-</td><td>The input will be such that the locations of the <b>n</b> frogs will all be distinct.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>2</pre></td></tr><tr><td><pre>{1,4}</pre></td></tr><tr><td><pre>{1,3}</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>5</pre></td></tr></table></td></tr><tr><td><pre>Returns: 2</pre></td></tr><tr><td><table><tr><td colspan="2">We have two frogs: one at (1, 1) and the other at (4, 3). Regardless of the range of the walkie-talkies, these two frogs cannot communicate. Hence, Manish can always make two distinct promises.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>2</pre></td></tr><tr><td><pre>{1,3}</pre></td></tr><tr><td><pre>{1,3}</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>5</pre></td></tr></table></td></tr><tr><td><pre>Returns: 1</pre></td></tr><tr><td><table><tr><td colspan="2">Here we have two frogs located at (1, 1) and (3, 3).
For any pair (L, R) such that 1 &lt;= L &lt; R &lt;= 5, the closed interval [L,R] will contain some value x such that the first frog can get to the other in x hops.
Hence, regardless of the range of walkie-talkies, Manish must always tell both frogs the same promise.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>2</pre></td></tr><tr><td><pre>{5,21232}</pre></td></tr><tr><td><pre>{6,123}</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>5132</pre></td></tr></table></td></tr><tr><td><pre>Returns: 2</pre></td></tr><tr><td><table><tr><td colspan="2">These two frogs are too far from each other, the ranges of walkie-talkies we are interested in are not sufficient to reach from one frog to the other.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">3)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>18</pre></td></tr><tr><td><pre>{16, 21, 33, 46, 10}</pre></td></tr><tr><td><pre>{22, 25, 46, 18, 8}</pre></td></tr><tr><td><pre>1253</pre></td></tr><tr><td><pre>47</pre></td></tr><tr><td><pre>31</pre></td></tr><tr><td><pre>12</pre></td></tr><tr><td><pre>86</pre></td></tr></table></td></tr><tr><td><pre>Returns: 394234239</pre></td></tr><tr><td><table><tr><td colspan="2">For reference, the full arrays X and Y once you finish generating them should look as follows:
<pre>
X = { 16, 21, 33, 46, 10, 19, 8, 15, 42, 38, 21, 25, 2, 11, 1, 11, 29, 45 }
Y = { 22, 25, 46, 18, 8, 28, 14, 24, 21, 26, 15, 30, 28, 23, 16, 30, 23, 9 }
</pre></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">4)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>9</pre></td></tr><tr><td><pre>{28, 33, 6, 14, 20, 35, 49, 15, 46}</pre></td></tr><tr><td><pre>{48, 32, 11, 28, 1, 22, 24, 41, 1}</pre></td></tr><tr><td><pre>1522</pre></td></tr><tr><td><pre>9</pre></td></tr><tr><td><pre>35</pre></td></tr><tr><td><pre>18</pre></td></tr><tr><td><pre>55</pre></td></tr></table></td></tr><tr><td><pre>Returns: 512091044</pre></td></tr><tr><td><table><tr><td colspan="2">If the range for the walkie-talkies is [18,19], [18,20], or [19,20], Manish will be able to make four different promises. In each of the 700 other valid scenarios Manish can only make two different promises. Thus, the expected number of promises is (3*4 + 700*2) / 703 = </td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">5)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>70874</pre></td></tr><tr><td><pre>{}</pre></td></tr><tr><td><pre>{}</pre></td></tr><tr><td><pre>477403840</pre></td></tr><tr><td><pre>153268855</pre></td></tr><tr><td><pre>153409203</pre></td></tr><tr><td><pre>523210</pre></td></tr><tr><td><pre>465494481</pre></td></tr></table></td></tr><tr><td><pre>Returns: 248460139</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>
